name: Shellcheck

on: [push, pull_request]

jobs:
  shellcheck:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install ShellCheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck

      - name: Run ShellCheck
        shell: bash
        run: |
          echo "=========================================="
          echo "Checking shell script syntax"
          echo "=========================================="
          
          # Find all shell scripts, including those without extensions
          # We use the 'file' command to detect shell scripts by their shebang or content
          SHELL_SCRIPTS=$(find . -type f -not -path './.git/*' -exec file {} \; | grep -E '^[^:]*: .*(shell script|/bin/(ba)?sh)' | cut -d: -f1)
          
          if [ -z "$SHELL_SCRIPTS" ]; then
            echo "No shell scripts found"
            exit 0
          fi
          
          FOUND_ERROR=0
          
          while IFS= read -r SCRIPT; do
            echo ""
            echo "---------------------------------------------------"
            echo "üîç Checking $SCRIPT..."
            echo "---------------------------------------------------"
            
            if shellcheck "$SCRIPT"; then
              echo "‚úÖ $SCRIPT passed"
            else
              echo "‚ùå $SCRIPT failed"
              FOUND_ERROR=1
            fi
          done <<< "$SHELL_SCRIPTS"
          
          echo ""
          echo "=========================================="
          if [ "$FOUND_ERROR" -eq 1 ]; then
            echo "‚ùå FAILURE: Some shell scripts have syntax errors"
            echo "=========================================="
            exit 1
          else
            echo "‚úÖ SUCCESS: All shell scripts are valid"
            echo "=========================================="
          fi
